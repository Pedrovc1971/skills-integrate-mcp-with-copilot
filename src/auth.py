"""\nAuthentication module for Mergington High School Activity System\nProvides user authentication with JWT tokens and password hashing\n"""\n\nfrom datetime import datetime, timedelta\nfrom typing import Optional\nimport hashlib\nimport secrets\nimport jwt\nfrom fastapi import HTTPException, Depends\nfrom fastapi.security import HTTPBearer, HTTPAuthCredentials\n\n# Secret key for JWT encoding (in production, use environment variable)\nSECRET_KEY = \"your-secret-key-change-in-production\"\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\n\nsecurity = HTTPBearer()\n\n\ndef hash_password(password: str) -> str:\n    \"\"\"Hash password using SHA256 with salt\"\"\"\n    salt = secrets.token_hex(16)\n    pwd_hash = hashlib.pbkdf2_hmac('sha256', password.encode(), salt.encode(), 100000)\n    return f\"{salt}${pwd_hash.hex()}\"\n\n\ndef verify_password(password: str, password_hash: str) -> bool:\n    \"\"\"Verify password against hash\"\"\"\n    try:\n        salt, pwd_hash = password_hash.split('$')\n        pwd_hash_check = hashlib.pbkdf2_hmac('sha256', password.encode(), salt.encode(), 100000)\n        return pwd_hash_check.hex() == pwd_hash\n    except:\n        return False\n\n\ndef create_access_token(data: dict, expires_delta: Optional[timedelta] = None) -> str:\n    \"\"\"Create JWT access token\"\"\"\n    to_encode = data.copy()\n    \n    if expires_delta:\n        expire = datetime.utcnow() + expires_delta\n    else:\n        expire = datetime.utcnow() + timedelta(minutes=15)\n    \n    to_encode.update({\"exp\": expire})\n    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n    return encoded_jwt\n\n\ndef verify_token(credentials: HTTPAuthCredentials = Depends(security)) -> dict:\n    \"\"\"Verify JWT token from request headers\"\"\"\n    token = credentials.credentials\n    try:\n        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n        email: str = payload.get(\"email\")\n        if email is None:\n            raise HTTPException(status_code=401, detail=\"Invalid token\")\n        return {\"email\": email, \"role\": payload.get(\"role\", \"student\")}\n    except jwt.ExpiredSignatureError:\n        raise HTTPException(status_code=401, detail=\"Token expired\")\n    except jwt.InvalidTokenError:\n        raise HTTPException(status_code=401, detail=\"Invalid token\")